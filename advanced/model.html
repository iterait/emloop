<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Model &#8212; cxflow 0.7.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/highlight.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hooks" href="hook.html" />
    <link rel="prev" title="Dataset" href="dataset.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          cxflow</a>
        <span class="navbar-text navbar-version pull-left"><b>0.7</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../getting_started.html">Getting Started</a></li>
                <li><a href="../tutorial.html">Tutorial</a></li>
                <li><a href="index.html">Advanced</a></li>
                <li><a href="../cli.html">CLI Reference</a></li>
                <li><a href="../cxflow/index.html">API Reference</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<div class="side_nav">
    <a href="dataset.html" title="Previous Chapter: Dataset"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Dataset</span>
    </a>
    </div>
<div class="side_nav">
    <a href="hook.html" title="Next Chapter: Hooks"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Hooks &raquo;</span>
    </a>
    </div><ul>
<li><a class="reference internal" href="#">Model</a><ul>
<li><a class="reference internal" href="#running-the-model">Running the Model</a></li>
<li><a class="reference internal" href="#restoring-the-model">Restoring the Model</a></li>
</ul>
</li>
</ul>

<form action="../search.html" method="get" class="searchbox">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="model">
<h1>Model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h1>
<p>Model is the second component of the cxflow environment.
It defines the machine learning part of the whole workflow.
The model object is defined by <code class="docutils literal"><span class="pre">cxflow.AbstractModel</span></code> interface.</p>
<p>The model constructor accepts a dataset instance, path to the logging directory and the information whether
(and from where) the model should be restored or whether a new one should be created.</p>
<p>Additionally, every model has to define two properties, <code class="docutils literal"><span class="pre">input_names</span></code> and <code class="docutils literal"><span class="pre">output_names</span></code>.
These properties should return the corresponding lists of input and output variable names.
The input names are expected to exist in every batch as the keys to the batch dictionary.
The output names are the variables which the model computes and outputs and may be used
by statistical hooks and similar.
In the case of our animal recognition example from the <a class="reference external" href="dataset.html">dataset</a> tutorial,
the input names would contain <code class="docutils literal"><span class="pre">image</span></code> and <code class="docutils literal"><span class="pre">animal</span></code> while the output
names would contain <code class="docutils literal"><span class="pre">predicted_animal</span></code> and <code class="docutils literal"><span class="pre">loss</span></code>.</p>
<div class="section" id="running-the-model">
<h2>Running the Model<a class="headerlink" href="#running-the-model" title="Permalink to this headline">¶</a></h2>
<p>The most important method of the model is <code class="docutils literal"><span class="pre">run</span></code>.
This method evaluates the model on a single batch given as the first parameter.
The second parameter is a boolean variable determining whether the model should update (train) on this batch or not.</p>
<p>Note that the trained model is not persistent as it is only stored in the memory.
The persistence of the model is provided by <code class="docutils literal"><span class="pre">save</span></code> method which dumps the model to the
filesystem (although this behavior is model-specific and you may implement it as you wish in you own models).
The <code class="docutils literal"><span class="pre">save</span></code> method shall accept only a single parameter and that is the name for the dumped file(s).</p>
<p>The pseudocode of model training, evaluation and saving may look as follows.
Note that this loop is automatically managed by <code class="docutils literal"><span class="pre">cxflow.MainLoop</span></code> and we publish this snippet just in order to
demonstrate the process.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># TODO model construction should be here</span>

<span class="k">for</span> <span class="n">epoch_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">train_batch</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">train_stream</span><span class="p">():</span>
        <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">train_batch</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">test_batch</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">test_stream</span><span class="p">():</span>
        <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">test_batch</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name_suffix</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">epoch_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="restoring-the-model">
<h2>Restoring the Model<a class="headerlink" href="#restoring-the-model" title="Permalink to this headline">¶</a></h2>
<p>Once the model is successfully saved, it can be also restored.
This is done when the training is about to continue (<code class="docutils literal"><span class="pre">cxflow</span> <span class="pre">resume</span></code>) or in a production environemt (<code class="docutils literal"><span class="pre">cxflow</span> <span class="pre">predict</span></code>).
Both commands expect a single positional argument specifying from where the model shall be loaded.
This argument is called <code class="docutils literal"><span class="pre">restore_from</span></code> and it is passed to the model constructor (see above).</p>
<p>If the <code class="docutils literal"><span class="pre">restore_from</span></code> argument is passed to the constructor, the model attempts to restore the model.
Most often, it will consider the argument to be a file path and loads the file, however, the implementation
is model-specific and may be implemented differently.</p>
<p>In order to restore the model, cxflow needs to know what class should be instantiated to be able to call
its constructor with the given <code class="docutils literal"><span class="pre">restore_from</span></code> argument.
The class is inferred from the dumped configuration file in the output directory, specifically from the
<code class="docutils literal"><span class="pre">model.class</span></code> entry.
However, there are cases in which the original class cannot be constructed (somebody deleted source codes
with the model object implementations etc.).
For these cases, each model should implement a <code class="docutils literal"><span class="pre">restore_fallback</span></code> method, which usually points
to a backend-specific baseclass which is able to restore the saved files of all its subclasses.
For instance, in the <code class="docutils literal"><span class="pre">cxflow-tensorflow</span></code> backend, the <code class="docutils literal"><span class="pre">restore_fallback</span></code> class returns
<code class="docutils literal"><span class="pre">cxflow_tensorflow.models.BaseModel</span></code> which it is able to load any checkpoint
without the need for the original model source codes.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, Cognexa Solutions s.r.o..<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>